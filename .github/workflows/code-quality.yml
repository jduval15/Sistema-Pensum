name: Code Quality

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  quality-check:
    name: Verificaci√≥n de Calidad
    runs-on: ubuntu-latest

    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Verificar formato de archivos
        run: |
          echo "Verificando archivos del proyecto..."
          find . -name "*.js" -o -name "*.ts" -o -name "*.tsx" | head -10

      - name: Verificar estructura del proyecto
        run: |
          echo "‚úÖ Estructura Backend:"
          ls -la backend/src/ || echo "‚ùå Falta carpeta backend/src"

          echo ""
          echo "‚úÖ Estructura Frontend:"
          ls -la frontend/src/ || echo "‚ùå Falta carpeta frontend/src"

      - name: Verificar archivos de configuraci√≥n
        run: |
          echo "Verificando archivos cr√≠ticos..."
          test -f backend/package.json && echo "‚úÖ backend/package.json" || echo "‚ùå Falta backend/package.json"
          test -f frontend/package.json && echo "‚úÖ frontend/package.json" || echo "‚ùå Falta frontend/package.json"
          test -f backend/prisma/schema.prisma && echo "‚úÖ schema.prisma" || echo "‚ùå Falta schema.prisma"
          test -f README.md && echo "‚úÖ README.md" || echo "‚ùå Falta README.md"

      - name: Contar l√≠neas de c√≥digo
        run: |
          echo "üìä Estad√≠sticas del proyecto:"
          echo "Backend:"
          find backend/src -name "*.js" | xargs wc -l | tail -1
          echo "Frontend:"
          find frontend/src -name "*.tsx" -o -name "*.ts" | xargs wc -l | tail -1

      - name: Verificar dependencias de seguridad
        run: |
          echo "Auditando dependencias del backend..."
          cd backend && npm ci && npm audit --audit-level=high || true
          echo ""
          echo "Auditando dependencias del frontend..."
          cd ../frontend && npm ci && npm audit --audit-level=high || true
