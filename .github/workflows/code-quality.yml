name: Code Quality

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  quality-check:
    name: VerificaciÃ³n de Calidad del CÃ³digo
    runs-on: ubuntu-latest

    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Verificar estructura de carpetas
        run: |
          echo "ğŸ“ Verificando estructura del proyecto..."
          test -d backend/src || (echo "âŒ Falta carpeta backend/src" && exit 1)
          test -d frontend/src || (echo "âŒ Falta carpeta frontend/src" && exit 1)
          echo "âœ… Estructura verificada"

      - name: Verificar archivos crÃ­ticos
        run: |
          echo "ğŸ” Verificando archivos esenciales..."
          test -f backend/package.json || (echo "âŒ Falta backend/package.json" && exit 1)
          test -f frontend/package.json || (echo "âŒ Falta frontend/package.json" && exit 1)
          test -f backend/prisma/schema.prisma || (echo "âŒ Falta schema.prisma" && exit 1)
          test -f README.md || (echo "âŒ Falta README.md" && exit 1)
          echo "âœ… Archivos crÃ­ticos presentes"

      - name: Verificar formato de cÃ³digo (Prettier)
        run: |
          echo "ğŸ§¾ Verificando formato de cÃ³digo..."
          npx prettier --check "**/*.{js,ts,tsx,json,md}" || (echo "âŒ Formato incorrecto" && exit 1)
          echo "âœ… Formato correcto"

      - name: AnÃ¡lisis de cÃ³digo (ESLint)
        run: |
          echo "ğŸ§  Ejecutando ESLint..."
          npx eslint . --ext .js,.ts,.tsx || (echo "âŒ Errores de lint detectados" && exit 1)
          echo "âœ… Lint sin errores"

      - name: Contar lÃ­neas de cÃ³digo
        run: |
          echo "ğŸ“Š EstadÃ­sticas del proyecto:"
          echo "Backend:"
          find backend/src -type f \( -name "*.ts" -o -name "*.js" \) -exec wc -l {} + | tail -n 1
          echo "Frontend:"
          find frontend/src -type f \( -name "*.ts" -o -name "*.tsx" \) -exec wc -l {} + | tail -n 1
